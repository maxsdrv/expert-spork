version: v2beta1

commands:
  # Run all tests
  tests: |-
    cd tests 2>/dev/null || true
    pdm install
    pdm run pytest -rpf "$@"

  # Individual test commands
  test-core: |-
    cd tests 2>/dev/null || true
    pdm install
    pdm run pytest -rpf tests/integration/test_core_services.py "$@"

  test-validation: |-
    cd tests 2>/dev/null || true
    pdm install
    pdm run pytest -rpf tests/integration/test_validation.py "$@"

  test-device: |-
    cd tests 2>/dev/null || true
    pdm install
    pdm run pytest -rpf tests/integration/test_device_control.py "$@"

  test-camera: |-
    cd tests 2>/dev/null || true
    pdm install
    pdm run pytest -rpf tests/integration/test_camera.py "$@"

  # Dependencies
  deps: |-
    cd tests 2>/dev/null || true
    pdm install

  # Generate models from protobuf
  tests_update_models: |-
    export CI_SERVER_HOST=
    echo "üîÑ Generating Pydantic models from protobuf definitions..."
    mkdir -p tests/scripts
    mkdir -p tests/integration/models
    python3 tests/scripts/generate_models.py api/proto tests/integration/models/provider_api.py "DDS Provider API" || \
    echo "‚ö†Ô∏è Model generation failed. Make sure tests/scripts/generate_models.py exists"
