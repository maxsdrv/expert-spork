clang-release-debian/mr:
  stage: build
  image: $DEBIAN_IMAGE
  script:
    - mkdir .build
    - pushd .build
    - >
      cmake -DCMAKE_CXX_COMPILER=clang++ \
            -DCMAKE_C_COMPILER=clang \
            -DCMAKE_BUILD_TYPE=Release \
            -DQT_QMAKE_EXECUTABLE=qmake \
            -DNO_BARE_METAL_TESTS=ON ../
    - make -j $JOBS_NUMBER
    - ctest --output-on-failure -j 1
    - make package
    - apt-get update
    - apt-get install -y ./dist/*.deb
    - lccinspector
  artifacts:
    paths:
    - .build/dist/*.deb
  only:
    - merge_requests

clang-debug-debian/mr:
  stage: build
  image: $DEBIAN_IMAGE
  script:
    - mkdir .build
    - pushd .build 
    - >
      cmake -DCMAKE_CXX_COMPILER=clang++ \
            -DCMAKE_C_COMPILER=clang \
            -DCMAKE_BUILD_TYPE=Debug \
            -DQT_QMAKE_EXECUTABLE=qmake \
            -DNO_BARE_METAL_TESTS=ON ../
    - make -j $JOBS_NUMBER
    - ctest --output-on-failure -j 1
  only:
    - merge_requests

gcc-release-debian/mr:
  stage: build
  image: $DEBIAN_IMAGE
  script:
    - mkdir .build
    - pushd .build
    - >
      cmake -DCMAKE_CXX_COMPILER=g++-11 \
            -DCMAKE_C_COMPILER=gcc-11 \
            -DCMAKE_BUILD_TYPE=Release \
            -DQT_QMAKE_EXECUTABLE=qmake \
            -DNO_BARE_METAL_TESTS=ON ../
    - make -j $JOBS_NUMBER
    - ctest --output-on-failure -j1
  only:
    - merge_requests

gcc-debug-debian/mr:
  stage: build
  image: $DEBIAN_IMAGE
  script:
    - mkdir .build
    - pushd .build 
    - >
      cmake -DCMAKE_CXX_COMPILER=g++-11 \
            -DCMAKE_C_COMPILER=gcc-11 \
            -DCMAKE_BUILD_TYPE=Debug \
            -DQT_QMAKE_EXECUTABLE=qmake \
            -DNO_BARE_METAL_TESTS=ON ../
    - make -j $JOBS_NUMBER
    - ctest --output-on-failure -j 1
  only:
    - merge_requests


gcc-release-ubuntu/mr:
  stage: build
  image: $UBUNTU_IMAGE
  script:
    - mkdir .build
    - pushd .build
    - >
      cmake -DCMAKE_CXX_COMPILER=g++-11 \
            -DCMAKE_C_COMPILER=gcc-11 \
            -DCMAKE_BUILD_TYPE=Release \
            -DQT_QMAKE_EXECUTABLE=qmake \
            -DNO_BARE_METAL_TESTS=ON ../
    - make -j $JOBS_NUMBER
    - ctest --output-on-failure -j 1
  only:
    - merge_requests

clang-release-ubuntu/mr:
  stage: build
  image: $UBUNTU_IMAGE
  script:
    - mkdir .build
    - pushd .build
    - >
      cmake -DCMAKE_CXX_COMPILER=clang++ \
            -DCMAKE_C_COMPILER=clang \
            -DCMAKE_BUILD_TYPE=Release \
            -DQT_QMAKE_EXECUTABLE=qmake \
            -DNO_BARE_METAL_TESTS=ON ../
    - make -j $JOBS_NUMBER
    - ctest --output-on-failure -j 1
    - make package
    - apt-get update
    - apt-get install -y ./dist/*.deb
    - lccinspector
  artifacts:
    paths:
    - .build/dist/*.deb
  only:
    - merge_requests

gcc-debug-ubuntu/mr:
  stage: build
  image: $UBUNTU_IMAGE
  script:
    - mkdir .build
    - pushd .build
    - >
      cmake -DCMAKE_CXX_COMPILER=g++-11 \
            -DCMAKE_C_COMPILER=gcc-11 \
            -DCMAKE_BUILD_TYPE=Debug \
            -DQT_QMAKE_EXECUTABLE=qmake \
            -DNO_BARE_METAL_TESTS=ON ../
    - make -j $JOBS_NUMBER
    - ctest --output-on-failure -j 1
  only:
    - merge_requests
